services:
  test-env:
    build:
      context: docker/puppeteer
    volumes:
      - .:/code
      - ./screenshots:/code/screenshots
    working_dir: /code
    command: /usr/sbin/wait-for-it.sh -t 0 storybook-env:56789 -- node dist/main.js
    environment:
      STORYBOOK_HOST: storybook-env
      STORYBOOK_PORT: 56789
      PACKAGE_NAME: $PACKAGE_NAME
      STORY_NAME: $STORY_NAME
      RUNS: $RUNS
      COPIES: $COPIES
      SAMPLES: $SAMPLES
    depends_on:
      - storybook-env
  storybook-env:
    build:
      context: docker/storybook
    entrypoint: "bolt"
    command: "storybook $PACKAGE_NAME"
    volumes:
      - ../../../:/af
    working_dir: /af
