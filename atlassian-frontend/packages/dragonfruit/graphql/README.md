# Package Dragonfruit GraphQL

This package contains all GraphQL related code used throughout Compass. This includes GraphQL Clients,
Queries, Mutations, Types, Utils and more. Most of this is automatically generated using Compass API
Schema, please see below.

## GraphQL Codegen

All GraphQL fragments, queries, and mutations should be written within this package inline with the
[Frontend GraphQL Guidelines](https://hello.atlassian.net/wiki/spaces/ServiceMatrix/pages/1022663560/CTAG-35+Frontend+GraphQL+Guidelines)
so that the appropriate files can be generated. However, since typechecks and tests are performed at a
repo level; it’s much safer for these generated files to be checked into the repo so that they don’t
have to be generated by unrelated scripts before being checked.

This means that anytime you make a change to the fragments, queries, or mutations within this package,
you should run one of the following commands to intentionally regenerate the files.

```shell
# From within /packages/dragonfruit/graphql
$ yarn generate
$ yarn generate:watch # Watch for changes and regenerate definitions

# From within /services/dragonfruit
$ yarn graphql
$ yarn graphql:watch # Watch for changes and regenerate definitions
```

## GraphQL Mock Providers

### Loading Provider

This provider can be used to quickly and easily test loading states without having to worry about timing.
Simply wrap a component with this provider, and any operations its children perform will load indefinitely.

```tsx
// Every query within ServiceDetailsPage will have `loading: true` and never resolve

<ApolloLoadingProvider>
  <ServiceDetailsPage
    {...defaultProps}
    propertyContextFields={propertyContextFields}
  />
</ApolloLoadingProvider>
```

### Network Error Provider

Similar to the Loading Provider, this is another lightweight provider for testing network errors.

```tsx
// Every query within ServiceDetailsPage will have `error: GraphQLError` and never resolve

<ApolloNetworkErrorProvider>
  <ServiceDetailsPage
    {...defaultProps}
    propertyContextFields={propertyContextFields}
  />
</ApolloNetworkErrorProvider>
```

This is convenient for testing network errors, but make sure that you take note the difference
between this, and a successful response that contains a QueryError.

### Auto Mock Provider

This provider used the GraphQL Codegen to import the schema and execute it locally. All queries
will succeed with fake data returned that fits the schema, and mutations can succeed if a
“resolver” is written for it.

```tsx
export const ComponentDetailsPageSuccess = () => {
  return (
    <ApolloAutoMockedProvider>
      <ServiceDetailsPage
        {...defaultProps}
        propertyContextFields={propertyContextFields}
      />
    </ApolloAutoMockedProvider>
  );
};
```

**To read more details about GraphQL Mocking please see [here](https://hello.atlassian.net/wiki/spaces/ServiceMatrix/pages/1042970581/CTAG-43+Frontend+GraphQL+Mocking)**
