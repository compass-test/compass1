buildNumber: '${IMAGE_VERSION}'
name: AF Service Dashboard
description: Dashboard for service deployments from atlassian-frontend

organization: UI Platform
notifications:
  email: mdejongh@atlassian.com
links:
  healthcheck:
    uri: /healthcheck
  source:
    url: git@bitbucket.org:atlassian/atlassian-frontend.git

computeClassification:
  dataType:
    - UGC/Primary # Tags
    - UGC/PrimaryIdentifier # Tags
    - PII/DirectRestrictedIdentifier # Staff ID
    - Usage/Telemetry # Custom data metrics

compose:
  webserver:
    image: ${IMAGE_NAME}
    ports:
      - 8080:8080
    tag: '${IMAGE_VERSION}'

config:
  environmentVariables:
    NODE_ENV: production
    BUILD_NUMBER: '${BITBUCKET_BUILD_NUMBER}'
    VERSION: '${PACKAGE_VERSION}'

resources:
  - type: postgres-db
    name: af-service-dashboard
    attributes:
      dataType:
        - UGC/Primary # Tags
        - UGC/PrimaryIdentifier # Tags

serviceProxy:
  enabled: true
  ingress:
    authentication:
      enabled: true
  plugins:
    auth:
      authentication:
        audiences:
          - af-service-dashboard
        plugins:
          - type: build
          - type: saml
            alias: ${DNS_ALIAS}
      authorization:
        plugins:
          - type: poco
