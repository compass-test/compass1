name: OSS CLA Internal
description: OSS CLA Internal
buildNumber: "${VERSION}"
notifications:
  email: gkong@atlassian.com
organization: UI Platform

computeClassification:
  dataType:
    - UGC/Label

cleanup: false

requiresAsap: true

links:
  source:
    url: git@bitbucket.org:atlassian/atlassian-frontend.git
  healthcheck:
    uri: /healthcheck
  binary:
    name: "${DOCKER_IMAGE}"
    tag: "${VERSION}"
    type: docker

network:
  ingress: internal
  egress: internet-only

resources:
  - type: postgres-db
    name: db
    attributes:
      dataType:
        - UGC/Label

  - type: cronman
    name: revoke-test-users
    lifecycle: deployment
    attributes:
      type: cron
      expression: 0 0 8 * * ?
      timezone: UTC
      notificationMethod: http_post
      notificationUrl: /api/contributor/revoke
      # Add additional test users to revoke on a daily basis
      payload: >
        {
          "users": ["cla-test-user"]
        }

serviceProxy:
  enabled: true
  ingress:
    authentication:
      enabled: true

  plugins:
    auth:
      authentication:
        plugins:
        - type: asap
      authorization:
        plugins:
        - type: poco
