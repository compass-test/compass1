version: 2
name: Dragonfruit Frontend

organization: 'Engineering-Jira Software'
notifications:
  email: achuzhmarov@atlassian.com

static:
  cache:
    compress: true
    maxTTL: 86400 # one day
  content: dist/
  errors:
    - errorCode: 404
      errorCachingMinTTL: 500
      responseCode: 200
      responsePagePath: /index.html
    - errorCode: 500
      errorCachingMinTTL: 0 # do not cache error, they are most likely an S3 glitch. If we cache them - subsequent requests will result in 500s as well
      responseCode: 500
      responsePagePath: /index.html
  files:
    - match: '*'
      params:
        CacheControl: max-age=1209600, s-maxage=1209600 # 14 days (60 * 60 * 24 * 14)
    - match: '.*bundle.js.*'
      params:
        ContentType: application/javascript
    - match: 'index\.html'
      params:
        CacheControl: public, must-revalidate, proxy-revalidate, max-age=0, s-maxage=0 # Do not add caching to this, otherwise deploys will not update immediately
  origins:
    - CustomOriginConfig:
        OriginProtocolPolicy: https-only
      DomainName: api-private.stg.atlassian.com
      Id: stargate
  cacheBehaviors:
    - AllowedMethods:
        - DELETE
        - GET
        - HEAD
        - OPTIONS
        - PATCH
        - POST
        - PUT
      ForwardedValues:
        QueryString: true
        Cookies:
          Forward: all
        Headers:
          - '*'
      PathPattern: /gateway/api/*
      TargetOriginId: stargate
      ViewerProtocolPolicy: redirect-to-https
      MaxTTL: 0 # don't ever cache responses on the CloudFront side
      DefaultTTL: 0 # don't ever cache responses on the CloudFront side

    - ForwardedValues:
        QueryString: true
        Cookies:
          Forward: all
        Headers:
          - '*'
      PathPattern: /SetCST*
      TargetOriginId: stargate
      ViewerProtocolPolicy: https-only
      MaxTTL: 0 # don't ever cache responses on the CloudFront side
      DefaultTTL: 0 # don't ever cache responses on the CloudFront side
environmentOverrides:
  ddev:
    static:
      aliases:
        - dragonfruit-fe.dev.atl-paas.net
  stg-east:
    static:
      aliases:
        - dragonfruit-fe.staging.atl-paas.net
  prod-east:
    static:
      aliases:
        - dragonfruit-fe.prod.atl-paas.net
      origins:
        - CustomOriginConfig:
            OriginProtocolPolicy: https-only
          DomainName: api-private.atlassian.com
          Id: stargate
