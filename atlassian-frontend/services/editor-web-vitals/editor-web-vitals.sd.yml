name: Editor Web Vitals
notifications:
  email: jquintana@atlassian.com
organization: Editor
description: Editor Web Vitals application

buildNumber: '${IMAGE_VERSION}'

compose:
  webserver:
    image: '${IMAGE_NAME}'
    tag: '${IMAGE_VERSION}'
  slauth:
    image: docker.atl-paas.net/sox/micros/slauth-sidecar
    links:
      - webserver
    ports:
      - 8080:8080
    tag: stable

links:
  healthcheck:
    uri: /healthcheck
  source:
    url: git@bitbucket.org:atlassian/atlassian-frontend.git

requiresAsap: true

config:
  environmentVariables:
    NODE_ENV: production
    ALLOW_ORIGINS: 'http://localhost:8080/'
    STATLAS_NAMESPACE: 'atlassian-frontend'
    SLAUTH_BACKEND: 'http://webserver:8080'
    SLAUTH_PLUGINS: 'bypass,build,slauthtoken,saml'
    SLAUTH_BYPASS_ROUTES: '/healthcheck'
    SLAUTH_LOG_LEVEL: debug
    SLAUTH_SAML_CENTRIFY: 'centrify'

initialisationTimeouts:
  install: 900

cleanup: false

environmentOverrides:
  ddev:
    resources:
      - name: centrify
        type: centrify
        attributes:
          name: 'editor-web-vitals.ddev'
          description: Editor Web Vitals
          url: 'https://editor-web-vitals.ap-southeast-2.dev.atl-paas.net'
          generateCert: true
      - name: ddev
        type: globaledge
        attributes:
          upstream_only: true
  dev-west2:
    scaling:
      autoHibernation:
        enabled: false
    resources:
      - name: centrify
        type: centrify
        attributes:
          name: 'editor-web-vitals.dev-west2'
          description: Editor Web Vitals
          url: 'https://editor-web-vitals.us-west-2.dev.atl-paas.net'
          generateCert: true
      - name: dev-west2
        type: globaledge
        attributes:
          upstream_only: true
  dev:
    resources:
      - type: globaledge
        name: ingress
        attributes:
          routes:
            - match:
                prefix: '/'
              direct_response:
                status: 400
                body: 'You must prefix your request path with either /ddev/ or /dev-west2/'
